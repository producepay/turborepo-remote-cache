import { S3 } from '@aws-sdk/client-s3';
import s3 from 's3-blob-store';
export function createS3({ accessKey = process.env.AWS_ACCESS_KEY_ID || process.env.S3_ACCESS_KEY, secretKey = process.env.AWS_SECRET_ACCESS_KEY || process.env.S3_SECRET_KEY, bucket, region = process.env.AWS_REGION || process.env.S3_REGION, endpoint, s3OptionsPassthrough = {}, }) {
    const client = new S3({
        ...(accessKey && secretKey
            ? {
                credentials: {
                    accessKeyId: accessKey,
                    secretAccessKey: secretKey,
                    sessionToken: process.env.AWS_SESSION_TOKEN,
                },
            }
            : {}),
        ...(region ? { region } : {}),
        ...(endpoint ? { endpoint } : {}),
        ...(process.env.NODE_ENV === 'test'
            ? { sslEnabled: false, s3ForcePathStyle: true }
            : {}),
        ...s3OptionsPassthrough,
    });
    const location = s3({
        client,
        bucket,
    });
    return location;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiczMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvcGx1Z2lucy9yZW1vdGUtY2FjaGUvc3RvcmFnZS9zMy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsRUFBRSxFQUFrQixNQUFNLG9CQUFvQixDQUFBO0FBQ3ZELE9BQU8sRUFBRSxNQUFNLGVBQWUsQ0FBQTtBQVk5QixNQUFNLFVBQVUsUUFBUSxDQUFDLEVBQ3ZCLFNBQVMsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLGlCQUFpQixJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUN0RSxTQUFTLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLGFBQWEsRUFDMUUsTUFBTSxFQUNOLE1BQU0sR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLFVBQVUsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFDeEQsUUFBUSxFQUNSLG9CQUFvQixHQUFHLEVBQUUsR0FDZjtJQUNWLE1BQU0sTUFBTSxHQUFHLElBQUksRUFBRSxDQUFDO1FBQ3BCLEdBQUcsQ0FBQyxTQUFTLElBQUksU0FBUztZQUN4QixDQUFDLENBQUM7Z0JBQ0UsV0FBVyxFQUFFO29CQUNYLFdBQVcsRUFBRSxTQUFTO29CQUN0QixlQUFlLEVBQUUsU0FBUztvQkFDMUIsWUFBWSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCO2lCQUM1QzthQUNGO1lBQ0gsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUVQLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUM3QixHQUFHLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFFakMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxLQUFLLE1BQU07WUFDakMsQ0FBQyxDQUFDLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxnQkFBZ0IsRUFBRSxJQUFJLEVBQUU7WUFDL0MsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUVQLEdBQUcsb0JBQW9CO0tBQ3hCLENBQUMsQ0FBQTtJQUVGLE1BQU0sUUFBUSxHQUFHLEVBQUUsQ0FBQztRQUNsQixNQUFNO1FBQ04sTUFBTTtLQUNQLENBQUMsQ0FBQTtJQUVGLE9BQU8sUUFBUSxDQUFBO0FBQ2pCLENBQUMifQ==